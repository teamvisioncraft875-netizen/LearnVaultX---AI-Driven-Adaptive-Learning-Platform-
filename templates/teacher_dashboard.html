{% extends "base.html" %}

{% block title %}Teacher Dashboard - LearnVaultX{% endblock %}

{% block meta_robots %}noindex, nofollow{% endblock %}
{% block meta_description %}Manage your classes, track student performance, create quizzes, and get AI teaching
insights.{% endblock %}

{% block content %}
<!-- TEACHER DASHBOARD - UNIFIED WITH STUDENT DASHBOARD STRUCTURE -->
<div class="dashboard-app">
    <!-- LEFT SIDEBAR - FIXED - UNIFIED STRUCTURE -->
    <aside class="dash-sidebar" id="dashSidebar">
        <div class="sidebar-toggle-btn" onclick="toggleDesktopSidebar()">â—€</div>
        <div class="sidebar-brand-area">
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="LearnVaultX" class="brand-logo-img">
            <span class="brand-title-text">LearnVaultX</span>
            <span class="brand-role-badge teacher">Teacher</span>
        </div>

        <nav class="sidebar-nav-menu">
            <a href="#" class="nav-menu-item active" onclick="switchView('dashboard'); return false;">
                <span class="item-icon">âŠž</span>
                <span class="item-label">Dashboard</span>
            </a>
            <a href="#" class="nav-menu-item" onclick="switchView('classes'); return false;">
                <span class="item-icon">â—ˆ</span>
                <span class="item-label">My Classes</span>
            </a>
            <a href="#" class="nav-menu-item" onclick="switchView('analytics'); return false;">
                <span class="item-icon">ðŸ“Š</span>
                <span class="item-label">Analytics</span>
            </a>
            <a href="#" class="nav-menu-item" onclick="switchView('students'); return false;">
                <span class="item-icon">ðŸ‘¥</span>
                <span class="item-label">Students</span>
            </a>
            <a href="#" class="nav-menu-item" onclick="switchView('alerts'); return false;">
                <span class="item-icon">ðŸš¨</span>
                <span class="item-label">Alerts</span>
            </a>
            <a href="#" class="nav-menu-item" onclick="switchView('feedback'); return false;">
                <span class="item-icon">ðŸ’¬</span>
                <span class="item-label">Feedback</span>
            </a>
        </nav>

        <div class="sidebar-user-profile">
            <div class="user-avatar teacher">{{ session.name[0] if session.name else 'T' }}</div>
            <div class="user-info">
                <div class="user-name">{{ session.name }}</div>
                <div class="user-email">{{ session.get('email', 'teacher@example.com') }}</div>
            </div>
        </div>

        <div class="sidebar-logout-area">
            <a href="/logout" class="logout-button">
                <span class="logout-ico">ðŸšª</span>
                <span class="logout-txt">Logout</span>
            </a>
        </div>
    </aside>

    <!-- CENTER CONTENT - ADAPTIVE - UNIFIED STRUCTURE -->
    <main class="dash-center" id="dashCenter">
        <!-- Mobile Header -->
        <div class="dash-mobile-head">
            <button class="mob-sidebar-btn" onclick="toggleMobileSidebar()">â˜°</button>
            <span class="mob-brand-text">LearnVaultX Teacher</span>
            <button class="mob-ai-btn" onclick="toggleAI()">â—†</button>
        </div>

        <!-- DASHBOARD VIEW -->
        <div class="dash-view" id="dashboardView">
            <div class="dash-view-head">
                <h1 class="view-main-title">Welcome back, {{ session.name }}!</h1>
                <p class="view-sub-text">Manage your classes and empower your students</p>
            </div>

            <div class="dash-view-body">
                <!-- Quick Actions -->
                <section class="view-section">
                    <h2 class="section-label">Quick Actions</h2>
                    <div class="quick-act-grid">
                        <div class="quick-act-box" onclick="showCreateClassModal()">
                            <div class="qact-icon-wrapper">
                                <div class="qact-icon">+</div>
                            </div>
                            <h3 class="qact-title">Create Class</h3>
                            <p class="qact-text">Start a new course</p>
                            <button class="qact-btn">Start Now</button>
                        </div>
                        <div class="quick-act-box" onclick="switchView('analytics')">
                            <div class="qact-icon-wrapper">
                                <div class="qact-icon">â—­</div>
                            </div>
                            <h3 class="qact-title">View Analytics</h3>
                            <p class="qact-text">Track performance</p>
                            <button class="qact-btn">Go to Analytics</button>
                        </div>
                        <div class="quick-act-box" onclick="openAI()">
                            <div class="qact-icon-wrapper">
                                <div class="qact-icon">â—†</div>
                            </div>
                            <h3 class="qact-title">AI Assistant</h3>
                            <p class="qact-text">Get teaching insights</p>
                            <button class="qact-btn">Ask AI</button>
                        </div>
                    </div>
                </section>

                <!-- Overview Stats -->
                <section class="view-section">
                    <h2 class="section-label">Overview</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="totalClasses">{{ classes|length }}</div>
                            <div class="stat-label">Total Classes</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalStudents">0</div>
                            <div class="stat-label">Total Students</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalLectures">0</div>
                            <div class="stat-label">Lectures Uploaded</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalQuizzes">0</div>
                            <div class="stat-label">Quizzes Created</div>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <!-- MY CLASSES VIEW -->
        <div class="dash-view" id="classesView" style="display: none;">
            <div class="dash-view-head">
                <h1 class="view-main-title">My Classes</h1>
                <button class="btn-primary" onclick="showCreateClassModal()">+ Create Class</button>
            </div>

            <div class="dash-view-body">
                <div id="classListContainer" class="class-grid">
                    {% if classes %}
                    {% for class in classes %}
                    <div class="class-card">
                        <div class="card-border-glow"></div>
                        <h3 class="card-title">{{ class.title }}</h3>
                        <p class="card-desc">{{ class.description }}</p>
                        <div class="card-meta">
                            <span class="meta-item">ðŸ‘¥ {{ class.student_count or 0 }} students</span>
                            <span class="meta-item">ðŸ“š {{ class.lecture_count or 0 }} lectures</span>
                        </div>
                        <div class="card-actions">
                            <button class="btn-card primary" onclick="window.location.href='/class/{{ class.id }}'">View
                                Class</button>
                            <button class="btn-card secondary"
                                onclick="showUploadLectureModal({{ class.id }}, '{{ class.title }}')">Upload</button>
                            <button class="btn-card secondary"
                                onclick="showCreateQuizModal({{ class.id }}, '{{ class.title }}')">Quiz</button>
                        </div>
                    </div>
                    {% endfor %}
                    {% else %}
                    <div class="empty-state">
                        <div class="empty-icon">â—ˆ</div>
                        <h3 class="empty-title">No classes yet</h3>
                        <p class="empty-text">Create your first class to start teaching</p>
                        <button class="btn-primary" onclick="showCreateClassModal()">Create Class</button>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- ANALYTICS VIEW -->
        <div class="dash-view" id="analyticsView" style="display: none;">
            <div class="dash-view-head">
                <h1 class="view-main-title">Analytics & Insights</h1>
            </div>

            <div class="dash-view-body">
                <section class="view-section">
                    <div class="select-container">
                        <label for="analyticsClassSelect" class="select-label">Select a class to view analytics:</label>
                        <select id="analyticsClassSelect" class="select-input"
                            onchange="loadClassAnalytics(this.value)">
                            <option value="">Select a class...</option>
                            {% for class in classes %}
                            <option value="{{ class.id }}">{{ class.title }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div id="analyticsChartContainer" style="display:none; margin-bottom: 30px;">
                        <canvas id="classAnalyticsChart" style="max-height: 400px;"></canvas>
                    </div>
                    <div id="analyticsData" class="analytics-container"></div>
                </section>
            </div>
        </div>

        <!-- STUDENTS VIEW -->
        <div class="dash-view" id="studentsView" style="display: none;">
            <div class="dash-view-head">
                <h1 class="view-main-title">Students Overview</h1>
            </div>

            <div class="dash-view-body">
                <div id="studentsListContainer" class="students-grid"></div>
            </div>
        </div>

        <!-- ALERTS VIEW -->
        <div class="dash-view" id="alertsView" style="display: none;">
            <div class="dash-view-head">
                <h1 class="view-main-title">Student Alerts</h1>
            </div>
            <div class="dash-view-body">
                <div id="alertsListContainer" class="students-grid"></div>
            </div>
        </div>

        <!-- FEEDBACK VIEW -->
        <div class="dash-view" id="feedbackView" style="display: none;">
            <div class="dash-view-head">
                <h1 class="view-main-title">Student Feedback</h1>
            </div>
            <div class="dash-view-body">
                <div id="feedbackListContainer" class="students-grid"></div>
            </div>
        </div>
    </main>

    <!-- RIGHT PANEL - AI TEACHING ASSISTANT (Unified structure) -->
    <aside class="dash-ai" id="dashAIPanel">
        <div class="ai-header">
            <div class="ai-brand">
                <span class="ai-name">KyKnoX AI</span>
                <span class="ai-tag">Teaching Assistant</span>
            </div>
            <button class="ai-close" onclick="closeAI()">âœ•</button>
        </div>

        <div class="ai-modes">
            <button class="mode-tab active" data-mode="expert" onclick="switchAIMode('expert', this)">Expert</button>
            <button class="mode-tab" data-mode="coach" onclick="switchAIMode('coach', this)">Coach</button>
        </div>

        <!-- Language Selector -->
        <div style="padding: 12px 16px; border-bottom: 1px solid rgba(75, 85, 99, 0.3);">
            <label for="aiLanguageTeacher"
                style="display: block; font-size: 12px; color: #9ca3af; margin-bottom: 6px;">Language:</label>
            <select id="aiLanguageTeacher" onchange="localStorage.setItem('learnvaultx_ai_language', this.value)"
                style="width: 100%; padding: 8px 12px; font-size: 14px; background: #1f2937; color: #e5e7eb; border: 1px solid rgba(96, 165, 250, 0.3); border-radius: 8px;">
                <option value="english">English</option>
                <option value="hindi">à¤¹à¤¿à¤‚à¤¦à¥€ (Hindi)</option>
                <option value="odia">à¬“à¬¡à¬¼à¬¿à¬† (Odia)</option>
            </select>
        </div>

        <div class="ai-messages" id="aiMessagesContainer">
            <div class="ai-welcome">
                <div class="welcome-icon">â—†</div>
                <p class="welcome-msg">Hello! I'm your AI teaching assistant. Ask me for insights on student
                    performance, quiz creation ideas, or teaching strategies.</p>
            </div>
        </div>

        <div class="ai-input-area">
            <textarea class="ai-input" id="aiInputField" placeholder="Ask for teaching insights..." rows="2"></textarea>
            <button class="ai-send" onclick="sendAIMsg()">â†’</button>
        </div>
    </aside>

    <!-- AI FLOAT BUTTON (Visible when panel closed) -->
    <button class="ai-float" id="aiFloat" onclick="openAI()">
        <span>ðŸ¤–</span>
    </button>

    <!-- Mobile Overlay -->
    <div class="dash-overlay" id="dashOverlay" onclick="closeDashMobileOverlay()">
    </div>
</div>

<!-- MODALS -->
<!-- Create Class Modal -->
<div id="createClassModal" class="modal-overlay">
    <div class="modal-box">
        <div class="modal-header">
            <h2 class="modal-title">Create New Class</h2>
            <button class="modal-close" onclick="closeModal('createClassModal')">Ã—</button>
        </div>
        <div class="modal-body">
            <form id="createClassForm" onsubmit="createClass(event)">
                <div class="form-group">
                    <label for="className" class="form-label">Class Title*</label>
                    <input type="text" id="className" class="form-input" required
                        placeholder="e.g., Introduction to Python">
                </div>
                <div class="form-group">
                    <label for="classDescription" class="form-label">Description*</label>
                    <textarea id="classDescription" class="form-input" rows="4" required
                        placeholder="Brief description of the class..."></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeModal('createClassModal')">Cancel</button>
                    <button type="submit" class="btn-primary">Create Class</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Upload Lecture Modal -->
<div id="uploadLectureModal" class="modal-overlay">
    <div class="modal-box">
        <div class="modal-header">
            <h2 class="modal-title">Upload Lecture</h2>
            <button class="modal-close" onclick="closeModal('uploadLectureModal')">Ã—</button>
        </div>
        <div class="modal-body">
            <div id="uploadClassTitle" class="modal-info"></div>
            <form id="uploadLectureForm" onsubmit="uploadLecture(event)">
                <input type="hidden" id="uploadClassId">
                <div class="form-group">
                    <label for="lectureFile" class="form-label">Select File*</label>
                    <input type="file" id="lectureFile" class="form-input" required
                        accept=".pdf,.ppt,.pptx,.doc,.docx,.txt,.mp4,.mp3">
                    <small class="form-hint">Supported: PDF, PPT, PPTX, DOC, DOCX, TXT, MP4, MP3</small>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary"
                        onclick="closeModal('uploadLectureModal')">Cancel</button>
                    <button type="submit" class="btn-primary">Upload</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Create Quiz Modal -->
<div id="createQuizModal" class="modal-overlay">
    <div class="modal-box modal-lg">
        <div class="modal-header">
            <h2 class="modal-title">Create Quiz</h2>
            <button class="modal-close" onclick="closeModal('createQuizModal')">Ã—</button>
        </div>
        <div class="modal-body">
            <div id="quizClassTitle" class="modal-info"></div>
            <form id="createQuizForm" onsubmit="createQuiz(event)">
                <input type="hidden" id="quizClassId">
                <div class="form-group">
                    <label for="quizTitle" class="form-label">Quiz Title*</label>
                    <input type="text" id="quizTitle" class="form-input" required
                        placeholder="e.g., Python Basics Quiz">
                </div>
                <div class="form-group">
                    <label for="quizDescription" class="form-label">Description</label>
                    <textarea id="quizDescription" class="form-input" rows="2"
                        placeholder="Optional description..."></textarea>
                </div>
                <div class="form-group">
                    <div class="form-header">
                        <label class="form-label">Questions*</label>
                        <button type="button" class="btn-add" onclick="addQuestion()">+ Add Question</button>
                    </div>
                    <div id="questionsContainer"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeModal('createQuizModal')">Cancel</button>
                    <button type="submit" class="btn-primary">Create Quiz</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    window.__TEACHER_CLASSES__ = {{ classes | tojson }};

    // Close mobile sidebar overlay cleanly
    function closeDashMobileOverlay() {
        var s = document.getElementById('dashSidebar');
        if (s) { s.classList.remove('mobile-show', 'active', 'mobile-open'); }
        var o = document.getElementById('dashOverlay');
        if (o) { o.classList.remove('show', 'active'); o.style.display = ''; }
    }
</script>
<script src="{{ url_for('static', filename='js/teacher-dashboard.js') }}?v={{ config.APP_VERSION }}"></script>

<style>
    /* ============================================
        MOBILE OVERLAY FIX
        ============================================ */

    /* Overlay: hidden by default, shown when sidebar opens on mobile */
    .dash-overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.55);
        z-index: 900;
        cursor: pointer;
    }

    .dash-overlay.show,
    .dash-overlay.active {
        display: block !important;
    }

    /* ============================================
        UNIFIED DASHBOARD STYLES - TEACHER VERSION
        (Matches student dashboard structure exactly)
        ============================================ */

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        user-select: none;
    }

    input,
    textarea,
    .ai-input {
        user-select: text;
    }

    .dashboard-app {
        display: flex;
        height: 100vh;
        overflow: hidden;
        background: #0a0e1a;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    /* ============================================
       LEFT SIDEBAR - FIXED (UNIFIED)
       ============================================ */

    .dash-sidebar {
        width: 220px;
        background: #111827;
        border-right: 1px solid rgba(75, 85, 99, 0.3);
        display: flex;
        flex-direction: column;
        flex-shrink: 0;
    }

    .sidebar-brand-area {
        padding: 24px 20px;
        border-bottom: 1px solid rgba(75, 85, 99, 0.3);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        overflow: hidden;
    }

    .brand-logo-img {
        width: 40px;
        height: 40px;
        max-width: 40px;
        max-height: 40px;
        object-fit: contain;
        flex-shrink: 0;
    }

    .brand-title-text {
        font-size: 18px;
        font-weight: 700;
        color: #60a5fa;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 100%;
    }

    .brand-role-badge {
        font-size: 11px;
        font-weight: 600;
        padding: 4px 12px;
        border-radius: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .brand-role-badge.teacher {
        color: #f59e0b;
        background: rgba(245, 158, 11, 0.1);
    }

    .sidebar-nav-menu {
        flex: 1;
        padding: 16px 12px;
        display: flex;
        flex-direction: column;
        gap: 6px;
        overflow-y: auto;
    }

    .nav-menu-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 14px 16px;
        border-radius: 10px;
        color: #9ca3af;
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s;
        cursor: pointer;
    }

    .nav-menu-item:hover {
        background: rgba(96, 165, 250, 0.1);
        color: #e5e7eb;
        box-shadow: 0 0 12px rgba(96, 165, 250, 0.15);
    }

    .nav-menu-item.active {
        background: rgba(96, 165, 250, 0.15);
        color: #60a5fa;
        box-shadow: 0 0 16px rgba(96, 165, 250, 0.2);
    }

    .item-icon {
        font-size: 22px;
        width: 28px;
        text-align: center;
    }

    .sidebar-user-profile {
        padding: 16px 12px;
        border-top: 1px solid rgba(75, 85, 99, 0.3);
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, #ec4899, #8b5cf6);
        color: white;
        font-size: 18px;
        font-weight: 700;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .user-avatar.teacher {
        background: linear-gradient(135deg, #f59e0b, #ef4444);
    }

    .user-info {
        flex: 1;
        min-width: 0;
    }

    .user-name {
        font-size: 14px;
        font-weight: 600;
        color: #e5e7eb;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .user-email {
        font-size: 12px;
        color: #6b7280;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .sidebar-logout-area {
        padding: 16px 12px;
        border-top: 1px solid rgba(75, 85, 99, 0.3);
    }

    .logout-button {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        padding: 14px;
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.3);
        border-radius: 10px;
        color: #ef4444;
        text-decoration: none;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.2s;
        cursor: pointer;
    }

    .logout-button:hover {
        background: rgba(239, 68, 68, 0.2);
        box-shadow: 0 0 12px rgba(239, 68, 68, 0.2);
    }

    .logout-ico {
        font-size: 18px;
    }

    /* ============================================
       CENTER CONTENT - ADAPTIVE (UNIFIED)
       ============================================ */

    .dash-center {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        transition: margin-right 0.3s ease;
        min-width: 0;
    }

    .dash-center.ai-active {
        margin-right: 380px;
    }

    .dash-mobile-head {
        display: none;
    }

    .dash-view {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    .dash-view-head {
        padding: 32px 40px 24px;
        border-bottom: 1px solid rgba(75, 85, 99, 0.3);
        background: #111827;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .view-main-title {
        font-size: 28px;
        font-weight: 700;
        color: #e5e7eb;
        margin-bottom: 4px;
        max-width: 70%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .view-sub-text {
        font-size: 15px;
        color: #9ca3af;
    }

    .dash-view-body {
        flex: 1;
        padding: 32px 40px;
        overflow-y: auto;
        overflow-x: hidden;
        background: #0a0e1a;
        width: 100%;
        max-width: 1600px;
        margin: 0 auto;
    }

    .view-section {
        margin-bottom: 32px;
    }

    .section-label {
        font-size: 18px;
        font-weight: 600;
        color: #e5e7eb;
        margin-bottom: 16px;
    }

    /* Quick Actions Grid */
    .quick-act-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        max-width: 100%;
    }

    .quick-act-box {
        background: #111827;
        border: 1px solid rgba(75, 85, 99, 0.3);
        border-radius: 12px;
        padding: 24px;
        cursor: pointer;
        transition: all 0.2s;
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 180px;
    }

    .quick-act-box:hover {
        border-color: rgba(96, 165, 250, 0.5);
        box-shadow: 0 4px 20px rgba(96, 165, 250, 0.1);
        transform: translateY(-2px);
    }

    .qact-icon {
        font-size: 40px;
        margin-bottom: 12px;
    }

    .qact-title {
        font-size: 16px;
        font-weight: 600;
        color: #e5e7eb;
        margin-bottom: 6px;
    }

    .qact-text {
        font-size: 14px;
        color: #9ca3af;
        margin-bottom: 16px;
    }

    .qact-icon-wrapper {
        width: 56px;
        height: 56px;
        border-radius: 14px;
        background: rgba(96, 165, 250, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 14px;
    }

    .qact-btn {
        display: inline-block;
        width: 100%;
        padding: 10px 24px;
        background: linear-gradient(135deg, #60a5fa, #8b5cf6);
        color: #fff;
        font-size: 14px;
        font-weight: 600;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.25s ease;
        margin-top: auto;
    }

    .qact-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 14px rgba(96, 165, 250, 0.35);
    }

    /* Stats Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
    }

    .stat-card {
        background: #111827;
        border: 1px solid rgba(75, 85, 99, 0.3);
        border-radius: 12px;
        padding: 24px;
        text-align: center;
    }

    .stat-value {
        font-size: 36px;
        font-weight: 700;
        color: #60a5fa;
        margin-bottom: 8px;
    }

    .stat-label {
        font-size: 14px;
        color: #9ca3af;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    /* Class Grid */
    .class-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 24px;
    }

    .class-card {
        background: #111827;
        border: 1px solid rgba(75, 85, 99, 0.3);
        border-radius: 12px;
        padding: 24px;
        position: relative;
        overflow: hidden;
        transition: all 0.2s;
    }

    .class-card:hover {
        border-color: rgba(96, 165, 250, 0.5);
        box-shadow: 0 4px 20px rgba(96, 165, 250, 0.1);
    }

    .card-border-glow {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #60a5fa, #8b5cf6);
    }

    .card-title {
        font-size: 18px;
        font-weight: 700;
        color: #e5e7eb;
        margin-bottom: 8px;
    }

    .card-desc {
        font-size: 14px;
        color: #9ca3af;
        margin-bottom: 16px;
        line-height: 1.5;
    }

    .card-meta {
        display: flex;
        gap: 16px;
        margin-bottom: 16px;
        flex-wrap: wrap;
    }

    .meta-item {
        font-size: 13px;
        color: #6b7280;
    }

    .card-actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }

    .btn-card {
        flex: 1;
        min-width: 80px;
        padding: 10px 16px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
    }

    .btn-card.primary {
        background: #60a5fa;
        color: white;
    }

    .btn-card.primary:hover {
        background: #3b82f6;
    }

    .btn-card.secondary {
        background: rgba(96, 165, 250, 0.1);
        color: #60a5fa;
        border: 1px solid rgba(96, 165, 250, 0.3);
    }

    .btn-card.secondary:hover {
        background: rgba(96, 165, 250, 0.2);
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 60px 20px;
    }

    .empty-icon {
        font-size: 64px;
        margin-bottom: 16px;
        opacity: 0.3;
    }

    .empty-title {
        font-size: 20px;
        font-weight: 700;
        color: #e5e7eb;
        margin-bottom: 8px;
    }

    .empty-text {
        font-size: 15px;
        color: #9ca3af;
        margin-bottom: 24px;
    }

    /* Buttons */
    .btn-primary {
        padding: 12px 24px;
        background: #60a5fa;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }

    .btn-primary:hover {
        background: #3b82f6;
    }

    .btn-secondary {
        padding: 12px 24px;
        background: transparent;
        color: #9ca3af;
        border: 1px solid rgba(75, 85, 99, 0.3);
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }

    .btn-secondary:hover {
        border-color: rgba(96, 165, 250, 0.5);
        color: #60a5fa;
    }

    /* Select Container */
    .select-container {
        margin-bottom: 24px;
    }

    .select-label {
        display: block;
        font-size: 14px;
        font-weight: 600;
        color: #e5e7eb;
        margin-bottom: 8px;
    }

    .select-input {
        width: 100%;
        max-width: 400px;
        padding: 12px 16px;
        background: #111827;
        border: 1px solid rgba(75, 85, 99, 0.3);
        border-radius: 8px;
        color: #e5e7eb;
        font-size: 14px;
    }

    /* Analytics */
    .analytics-container {
        margin-top: 24px;
    }

    .analytics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
    }

    .analytics-card {
        background: #111827;
        border: 1px solid rgba(75, 85, 99, 0.3);
        border-radius: 12px;
        padding: 20px;
    }

    .analytics-name {
        font-size: 16px;
        font-weight: 700;
        color: #e5e7eb;
        margin-bottom: 16px;
    }

    .analytics-stats {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .analytics-stat {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .analytics-stat .stat-label {
        font-size: 13px;
        color: #9ca3af;
        text-transform: none;
    }

    .analytics-stat .stat-value {
        font-size: 16px;
        font-weight: 600;
        color: #60a5fa;
    }

    /* Students Grid */
    .students-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
    }

    .student-card {
        background: #111827;
        border: 1px solid rgba(75, 85, 99, 0.3);
        border-radius: 12px;
        padding: 24px;
        text-align: center;
    }

    .student-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, #60a5fa, #8b5cf6);
        color: white;
        font-size: 24px;
        font-weight: 700;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 16px;
    }

    .student-name {
        font-size: 16px;
        font-weight: 700;
        color: #e5e7eb;
        margin-bottom: 4px;
    }

    .student-email {
        font-size: 13px;
        color: #6b7280;
        margin-bottom: 8px;
    }

    .student-meta {
        font-size: 13px;
        color: #9ca3af;
    }

    /* ============================================
       RIGHT AI PANEL (UNIFIED)
       ============================================ */

    .dash-ai {
        position: fixed;
        right: -380px;
        top: 0;
        width: 380px;
        height: 100vh;
        background: #111827;
        border-left: 1px solid rgba(75, 85, 99, 0.3);
        display: flex;
        flex-direction: column;
        transition: right 0.3s ease;
        z-index: 100;
    }

    .dash-ai.open {
        right: 0;
    }

    .ai-header {
        padding: 20px;
        border-bottom: 1px solid rgba(75, 85, 99, 0.3);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .ai-brand {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .ai-name {
        font-size: 18px;
        font-weight: 700;
        color: #60a5fa;
    }

    .ai-tag {
        font-size: 11px;
        color: #6b7280;
    }

    .ai-close {
        width: 32px;
        height: 32px;
        border: none;
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
    }

    .ai-close:hover {
        background: rgba(239, 68, 68, 0.2);
    }

    .ai-modes {
        display: flex;
        gap: 8px;
        padding: 16px;
        border-bottom: 1px solid rgba(75, 85, 99, 0.3);
    }

    .mode-tab {
        flex: 1;
        padding: 10px;
        background: transparent;
        border: 1px solid rgba(75, 85, 99, 0.3);
        border-radius: 8px;
        color: #9ca3af;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }

    .mode-tab.active {
        background: rgba(96, 165, 250, 0.1);
        border-color: rgba(96, 165, 250, 0.5);
        color: #60a5fa;
    }

    .ai-messages {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
    }

    .ai-welcome {
        text-align: center;
        padding: 40px 20px;
    }

    .welcome-icon {
        font-size: 48px;
        margin-bottom: 16px;
        opacity: 0.3;
    }

    .welcome-msg {
        font-size: 14px;
        color: #9ca3af;
        line-height: 1.6;
    }

    .ai-msg {
        display: flex;
        gap: 12px;
        margin-bottom: 16px;
    }

    .msg-avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: #1f2937;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        font-size: 18px;
    }

    .msg-text {
        flex: 1;
        padding: 12px 16px;
        background: #1f2937;
        border-radius: 12px;
        color: #e5e7eb;
        font-size: 14px;
        line-height: 1.5;
    }

    .ai-msg.user-msg .msg-text {
        background: rgba(96, 165, 250, 0.1);
        border: 1px solid rgba(96, 165, 250, 0.3);
    }

    .ai-input-area {
        padding: 16px;
        border-top: 1px solid rgba(75, 85, 99, 0.3);
        display: flex;
        gap: 8px;
    }

    .ai-input {
        flex: 1;
        padding: 12px;
        background: #1f2937;
        border: 1px solid rgba(75, 85, 99, 0.3);
        border-radius: 8px;
        color: #e5e7eb;
        font-size: 14px;
        resize: none;
    }

    .ai-send {
        width: 48px;
        height: 48px;
        background: #60a5fa;
        border: none;
        border-radius: 8px;
        color: white;
        font-size: 20px;
        cursor: pointer;
        transition: all 0.2s;
    }

    .ai-send:hover {
        background: #3b82f6;
    }

    .ai-float {
        position: fixed;
        bottom: 24px;
        right: 24px;
        width: 60px;
        height: 60px;
        background: #60a5fa;
        border: none;
        border-radius: 50%;
        color: white;
        font-size: 28px;
        cursor: pointer;
        transition: all 0.2s;
        box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
        z-index: 50;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .ai-float:hover {
        transform: scale(1.1);
    }

    /* ============================================
       MODALS (UNIFIED)
       ============================================ */

    .modal-overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(4px);
        z-index: 200;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }

    .modal-box {
        background: #111827;
        border: 1px solid rgba(75, 85, 99, 0.3);
        border-radius: 16px;
        max-width: 600px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
    }

    .modal-box.modal-lg {
        max-width: 900px;
    }

    .modal-header {
        padding: 24px;
        border-bottom: 1px solid rgba(75, 85, 99, 0.3);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .modal-title {
        font-size: 20px;
        font-weight: 700;
        color: #e5e7eb;
    }

    .modal-close {
        width: 32px;
        height: 32px;
        border: none;
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
        border-radius: 8px;
        font-size: 24px;
        cursor: pointer;
        transition: all 0.2s;
    }

    .modal-close:hover {
        background: rgba(239, 68, 68, 0.2);
    }

    .modal-body {
        padding: 24px;
    }

    .modal-info {
        font-size: 14px;
        color: #60a5fa;
        margin-bottom: 16px;
    }

    .modal-footer {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        margin-top: 24px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-label {
        display: block;
        font-size: 14px;
        font-weight: 600;
        color: #e5e7eb;
        margin-bottom: 8px;
    }

    .form-input {
        width: 100%;
        padding: 12px 16px;
        background: #1f2937;
        border: 1px solid rgba(75, 85, 99, 0.3);
        border-radius: 8px;
        color: #e5e7eb;
        font-size: 14px;
    }

    .form-input:focus {
        outline: none;
        border-color: rgba(96, 165, 250, 0.5);
    }

    .form-hint {
        display: block;
        margin-top: 6px;
        font-size: 12px;
        color: #6b7280;
    }

    .form-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
    }

    .btn-add {
        padding: 8px 16px;
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid rgba(16, 185, 129, 0.3);
        border-radius: 8px;
        color: #10b981;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }

    .btn-add:hover {
        background: rgba(16, 185, 129, 0.2);
    }

    .question-block {
        background: #1f2937;
        border: 1px solid rgba(75, 85, 99, 0.3);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 16px;
    }

    .question-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
    }

    .question-num {
        font-size: 15px;
        font-weight: 700;
        color: #60a5fa;
    }

    .btn-remove {
        padding: 6px 12px;
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.3);
        border-radius: 6px;
        color: #ef4444;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }

    .btn-remove:hover {
        background: rgba(239, 68, 68, 0.2);
    }

    /* ============================================
       MOBILE RESPONSIVE
       ============================================ */

    .dash-overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 90;
    }

    .dash-overlay.show {
        display: block;
    }

    /* Tablet breakpoint */
    @media (max-width: 1024px) {

        .quick-act-grid,
        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 768px) {
        .dash-sidebar {
            position: fixed;
            left: -220px;
            top: 0;
            height: 100vh;
            z-index: 100;
            transition: left 0.3s ease;
        }

        .dash-sidebar.mobile-show {
            left: 0;
        }

        .dash-mobile-head {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: #111827;
            border-bottom: 1px solid rgba(75, 85, 99, 0.3);
        }

        .mob-sidebar-btn,
        .mob-ai-btn {
            width: 40px;
            height: 40px;
            background: rgba(96, 165, 250, 0.1);
            border: 1px solid rgba(96, 165, 250, 0.3);
            border-radius: 8px;
            color: #60a5fa;
            font-size: 20px;
            cursor: pointer;
        }

        .mob-brand-text {
            font-size: 16px;
            font-weight: 700;
            color: #e5e7eb;
        }

        .dash-view-head {
            padding: 20px;
        }

        .dash-view-body {
            padding: 20px;
        }

        .class-grid,
        .quick-act-grid,
        .stats-grid {
            grid-template-columns: 1fr;
        }

        .dash-ai {
            width: 100%;
            right: -100%;
        }

        .dash-center.ai-active {
            margin-right: 0;
        }

        /* Overlay for mobile sidebar */
        .dash-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            z-index: 95;
            transition: opacity 0.3s;
        }

        .dash-overlay.show {
            display: block;
        }
    }

    /* Sidebar Toggle Styles */
    .dash-sidebar {
        width: 260px;
        /* Enhanced width */
        transition: width 0.3s ease;
        position: relative;
        z-index: 50;
    }

    .dash-sidebar.collapsed {
        width: 80px;
    }

    .dash-sidebar.collapsed .brand-title-text,
    .dash-sidebar.collapsed .brand-role-badge,
    .dash-sidebar.collapsed .user-info,
    .dash-sidebar.collapsed .logout-button span,
    .dash-sidebar.collapsed .view-sub-text,
    .dash-sidebar.collapsed .item-label {
        display: none;
        opacity: 0;
    }

    .dash-sidebar.collapsed .sidebar-brand-area {
        padding: 20px 10px;
        justify-content: center;
    }

    .dash-sidebar.collapsed .brand-logo-img {
        margin: 0 auto;
    }

    .dash-sidebar.collapsed .nav-menu-item {
        justify-content: center;
        padding: 14px 10px;
    }

    .dash-sidebar.collapsed .item-icon {
        margin-right: 0;
        font-size: 24px;
    }

    .dash-sidebar.collapsed .sidebar-user-profile {
        justify-content: center;
        padding: 16px 10px;
    }

    .dash-sidebar.collapsed .user-avatar {
        margin: 0;
    }

    .sidebar-toggle-btn {
        position: absolute;
        top: 24px;
        right: -12px;
        width: 24px;
        height: 24px;
        background: #1f2937;
        border: 1px solid rgba(75, 85, 99, 0.5);
        border-radius: 50%;
        color: #9ca3af;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 60;
        transition: all 0.2s;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    .sidebar-toggle-btn:hover {
        background: #374151;
        color: #fff;
    }

    .dash-sidebar.collapsed .sidebar-toggle-btn {
        transform: rotate(180deg);
    }
</style>
{% endblock %}